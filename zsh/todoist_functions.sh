# todoist find project
function peco-todoist-project () {
  local SELECTED_PROJECT="$(todoist projects | peco | head -n1 | cut -d ' ' -f 1)"
  if [ -n "$SELECTED_PROJECT" ]; then
    if [ -n "$LBUFFER" ]; then
      local new_left="${LBUFFER%\ } $SELECTED_PROJECT"
    else
      local new_left="$SELECTED_PROJECT"
    fi
    BUFFER=${new_left}${RBUFFER}
    CURSOR=${#new_left}
  fi
}
zle -N peco-todoist-project
bindkey "^ztp" peco-todoist-project

# todoist find labels
function peco-todoist-labels () {
  local SELECTED_LABELS="$(todoist labels | peco | cut -d ' ' -f 1 | tr '\n' ',' | sed -e 's/,$//')"
  if [ -n "$SELECTED_LABELS" ]; then
    if [ -n "$LBUFFER" ]; then
      local new_left="${LBUFFER%\ } $SELECTED_LABELS"
    else
      local new_left="$SELECTED_LABELS"
    fi
    BUFFER=${new_left}${RBUFFER}
    CURSOR=${#new_left}
  fi
}
zle -N peco-todoist-labels
bindkey "^ztl" peco-todoist-labels

# todoist close
function peco-todoist-close () {
  local SELECTED_ITEMS="$(todoist list | peco | cut -d ' ' -f 1 | tr '\n' ' ')"
  if [ -n "$SELECTED_ITEMS" ]; then
    BUFFER="todoist close $(echo "$SELECTED_ITEMS" | tr '\n' ' ')"
    CURSOR=$#BUFFER
  fi
  zle accept-line
}
zle -N peco-todoist-close
bindkey "^ztc" peco-todoist-close

# todoist close today task
function peco-todoist-today-close () {
  local SELECTED_ITEMS="$(todoist l | grep)"
}
